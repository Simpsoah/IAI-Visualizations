<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <!--[if lte IE 7]>
        <script
        <script src="lib/json2.js"></script>
        <![endif]-->
    <!--[if lte IE 8]>
        <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.js"></script>     
        <script>
            document.createElement('ng-include');
            document.createElement('ng-pluralize');
            document.createElement('ng-view');
            document.createElement('ng:include');
            document.createElement('ng:pluralize');
            document.createElement('ng:view');
        </script>
        <![endif]-->
    <!--[if lte IE 9]>
        <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>CTSA Expertise Visualization</title>
    <meta name="viewport" content="initial-scale=1.0,width=device-width" />
    <!-- TODO: Add these to Init somehow -->
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,300,500' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,600' rel='stylesheet' type='text/css'>
    <script src="lib/jquery-1.11.2.min.js"></script>
    <script src="lib/angular.min.js"></script>
    <script src="lib/head.js"></script>
    <script src="src/Init.js"></script>
</head>

<body ng-cns-vis-runner ng-controller="basicCtrl">
    <div class="container">
        <div class="left-column-expertise">
            <div class="box">
                <div class="box-header">
                    <h3>CTSA Hub Expertise</h3>
                </div>
                <div>
                    <div class="buttons-container">
                        <button id="toggleTrials">Toggle Clinical Trials</button>
                        <button id="togglePubs">Toggle Publications</button>
                        <button id="toggleAwards">Toggle Awards</button>
                    </div>
                    <div class="nav-container">
                        <button class="zoom-btns" id="plus">+</button>
                        <button class="zoom-btns" id="minus">-</button>
                    </div>
                    <!-- {CNS-VISUAL} CTSA Hub Expertise Table -->
                    <div ng-cns-visual ng-vis-type="D3ProportionalSymbol" id="pro-sym-01" ng-data-field="sampleGeoData" ng-identifier="proportionalSymbol01">
                    </div>
                    <!-- /{CNS-VISUAL} CTSA Hub Expertise Table -->
                </div>
            </div>
            <div class="box">
                <div class="box-content" style="overflow:hidden">
                    <!-- {CNS-VISUAL} Legend Components -->
                    <div id="legend-container">
                        <div class="legend-item">
                            <div ng-cns-visual ng-vis-type="ComponentShapeSizeLegend" id="triangle-legend" style="height:100%; width: 100%" ng-identifier="triangleLegend" ng-component-for="proportionalSymbol01">
                                <span id="ctsl" class="l2" style="color: black">#Clinical Trials</span>
                            </div>
                        </div>
                        <div class="legend-item">
                            <div ng-cns-visual ng-vis-type="ComponentShapeSizeLegend" id="square-legend" style="height:100%; width: 100%" ng-identifier="squareLegend" ng-component-for="proportionalSymbol01">
                                <span id="cssl" class="l2" style="color: black">#Publications</span>
                            </div>
                        </div>
                        <div class="legend-item">
                            <div ng-cns-visual ng-vis-type="ComponentShapeSizeLegend" id="diamond-legend" style="height:100%; width: 100%" ng-identifier="diamondLegend" ng-component-for="proportionalSymbol01">
                                <span id="cdsl" class="l2" style="color: black">#Awards</span>
                            </div>
                        </div>
                    </div>
                    <!-- /{CNS-VISUAL} Legend Components -->
                </div>
            </div>
            <div class="box">
                <div class="box-header">
                    <h3>Expertise</h3>
                </div>
                <div class="box-content">
                    <p style="color: black; text-align: left; height: 23px; margin: 0px">#Clinical Trials, #Publications, and #Awards by CTSA Hub</p>
                    <!-- {CNS-VISUAL} Expertise Bar Graph -->
                    <div ng-cns-visual ng-vis-type="BarGraphDistort" id="bar-chart-02" ng-data-field="sampleGeoData" ng-identifier="barChart02"></div>
                    <!-- /{CNS-VISUAL} Expertise Bar Graph -->
                </div>
            </div>
        </div>
        <div class="right-column-expertise">
            <div class="box" style="height: 10%;">
                <div class="box-header">
                    <h3>Filter '<span id="qparam"></span>' Results</h3>
                </div>
                <div class="box-content">
                    <!-- <div style="width:23%; float:left; text-align:left">
                        Using data from search on date
                        <p class="l" style="color:black">Current view generated from  search on<span id="qdate"></span></p>
                    </div> -->
                    <div style="width:100%; float:right; margin-top: 5px;">
                        <input id="search" placeholder="Filter" type="text"></input>
                        <button class="submit" value="Search" disabled>Filter...</button>
                    </div>
                </div>
            </div>
            <div class="box">
                <div class="box-header">
                    <h3>Clinical Trials</h3>
                </div>
                <div class="box-content">
                    <!-- {CNS-VISUAL} Clinical Trials Table -->
                    <div ng-cns-visual ng-vis-type="AngularTable" id="angular-table-trials" style="height: 20%" ng-data-field="master" ng-identifier="angularTableTrials">
                    </div>
                    <!-- /{CNS-VISUAL} Clinical Trials Table -->
                </div>
            </div>
            <div class="box">
                <div class="box-header">
                    <h3>Publications</h3>
                </div>
                <div class="box-content">
                    <!-- {CNS-VISUAL} Publications Table -->
                    <div ng-cns-visual ng-vis-type="AngularTable" id="angular-table-pubs" style="height: 20%" ng-data-field="master" ng-identifier="angularTablePubs">
                    </div>
                    <!-- /{CNS-VISUAL} Publications Table -->
                </div>
            </div>
            <div class="box">
                <div class="box-header">
                    <h3>NIH Awards</h3>
                </div>
                <div class="box-content">
                    <!-- {CNS-VISUAL} NIH Awards Table -->
                    <div ng-cns-visual ng-vis-type="AngularTable" id="angular-table-awards" style="height: 20%" ng-data-field="master" ng-identifier="angularTableAwards">
                    </div>
                    <!-- /{CNS-VISUAL} NIH Awards Table -->
                </div>
            </div>
            <div class="box">
                <div class="box-header">
                    <h3>Personnel Expertise</h3>
                </div>
                <div class="box-content">
                    <!-- {CNS-VISUAL} Personnel Expertise Table -->
                    <div ng-cns-visual ng-vis-type="AngularTable" id="angular-table-authors" style="height: 20%" ng-data-field="authors" ng-identifier="angularTableAuthors">
                    </div>
                    <!-- /{CNS-VISUAL} Personnel Expertise Table -->
                </div>
            </div>
        </div>
    </div>
</body>
<script>
    $("#pro-sym-01").css({
        "height": $(window).height() * .5
    })
    $("#bar-chart-02").css({
        "height": $(window).height() * .34 - 86
    })
    $("#angular-table-awards").css({
        "height": $(window).height() * .18125
    })
    $("#angular-table-pubs").css({
        "height": $(window).height() * .18125
    })
    $("#angular-table-trials").css({
        "height": $(window).height() * .18125
    })
    $("#angular-table-authors").css({
        "height": $(window).height() * .18125
    })

    var locationSearch = location.search.substring(1);
    if (locationSearch) {
        $("#qparam").html(JSON.parse('{"' + decodeURI(locationSearch).replace(/"/g, '\\"').replace(/&/g, '","').replace(/=/g, '":"') + '"}').set || '');
    }

    var searchVal = $("#search").val()
    $("#search").on("keyup", function() {
        if (searchVal != $("#search").val()) {
            searchVal = $("#search").val();
            ["angularTableAuthors", "angularTablePubs", "angularTableTrials", "angularTableAwards", "barChart02", "proportionalSymbol01"].forEach(function(d, i) {
                visualizations[d].applyFilter($("#search").val());
            })
        }
    })

    function debouncer(func, timeout) {
        var timeoutID, timeout = timeout || 200;
        return function() {
            var scope = this,
                args = arguments;
            clearTimeout(timeoutID);
            timeoutID = setTimeout(function() {
                func.apply(scope, Array.prototype.slice.call(args));
            }, timeout);
        }
    }


    $(window).resize(debouncer(function(e) {
        visualizations.barChart02.ResetVis({
            empty: true
        });
        visualizations.proportionalSymbol01.ResetVis({
            empty: true
        });
        $(".d3-tip").remove();
    }));
</script>

</html>
